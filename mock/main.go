package main

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"net/http"
	"time"
)

type ChatRes struct {
	Lecture string `json:"lecture"`
	Message string `json:"message"`
	Id      string `json:"id"`
}

type LectureRes []struct {
	Name     string `json:"name"`
	Abstract string `json:"abstract"`
	Url      string `json:"url"`
	Id       string `json:"id"`
}

type Reason struct {
	Id     string `json:"id"`
	Reason string `json:"reason"`
}

type ChatReq struct {
	ID string `json:"id"`
}

type BookReq struct {
	ID string `json:"id"`
}

type BookRes []struct {
	ID     string `json:"id"`
	Name   string `json:"name"`
	Author string `json:"author"`
}

const DemoMessage = `科目名実践的並列コンピューティング 概要現代の科学技術を支える重要技術である、並列計算・高性能計算の基礎についての講義・実習を行います。化学分野における分子シミュレーション、生物分野における蛋白質解析、応用数学分野における数理最適化問題など、スーパーコンピュータ等による大量の計算量・データ量を必要とする計算技術への要求が高まっています。本講義では、MPIやOpenMPなど高性能・並列計算のための標準的なプログラミング環境に加え、近年注目を集めているGPU・アクセラレータのためのプログラミング環境についても解説を行います。座学だけでなく、実際に東工大のペタスケールスパコンであるTSUBAMEを用いた実習を行います。 この講義のキーワードは,並列計算, 高性能計算, マルチコア, MPI, OpenMP, GPGPUです．
`

var DemoLecture2 = LectureRes{
	{
		Name:     "ゲノム情報学",
		Abstract: "本講義では、バイオインフォマティクスの一分野であるゲノム情報解析について学習する。ゲノム情報解析は、次世代シークエンサの登場とともに急速に発展を遂げている分野であり、その基礎をこの授業で学ぶことで生物学と情報科学の両方の力を身につけてほしい。 この講義のキーワードは,ゲノム情報学、配列解析、次世代シークエンサーです．",
		Url:      "https://google.com",
		Id:       "50405",
	},
	{
		Name:     "バイオインフォマティクス",
		Abstract: "本講義では、生命を情報システムとして据えるバイオインフォマティクスの分野を概観し、ゲノム情報解析、タンパク質構造情報解析、化学情報学等の領域での最新の研究の紹介を行う。また、その中で膨大で多様なデータから意味を抽出するために，様々な数理的技法が融合的に応用される様子を紹介し，情報工学の社会的な応用の実例を学ぶ。 この講義のキーワードは,ゲノム情報解析、タンパク質構造情報解析、化学情報学、計算生物学です．",
		Url:      "https://google.com",
		Id:       "50407",
	},
	{
		Name:     "生命倫理特論",
		Abstract: "ES細胞・iPS細胞や遺伝子編集を使った最先端医療、生殖補助医療技術、生命維持、遺伝子診断、遺伝情報の産業利用など、生命科学技術の目覚ましい発展は、医療・創薬、農林水産・工・情報等の広範な業種におよぶ産業利用、環境、日常生活と、広く社会に多大な影響を及ぼしている。これに伴い、次のような問題が多数生じている。・生命倫理：人の尊厳や人権に関する問題など・利用：ヒトゲノム情報、遺伝子や細胞の技術、遺伝資源（微生物や動植物）、利益配分に関わる問題（個人と企業や社会、資源保有国と利用国）など・制限と保全：遺伝子改変の許容範囲、生物多様性に関わる問題などこれらの問題について、科学者・技術者として、社会との関わりにおいて理解し考察を深めることが必須となっている。複数のテーマに関し、講師が具体例を示し解説したうえで、学生間・講師で議論し、考え方を深め、対応の仕方を学ぶ。 この講義のキーワードは,ヒトゲノム情報、バイオセキュリティ、遺伝資源、生物多様性です．",
		Url:      "https://google.com",
		Id:       "50408",
	},
	{
		Name:     "合成生物学",
		Abstract: "概要近年のバイオテクノロジーの発展により、生命システムを人工的にデザイン・設計することが可能となってきた。この分野の研究は合成生物学と呼ばれている。本講義では、合成生物学分野における基礎的な技術とそれが、生命システムのどのような理解につながったのか、どのように社会実装されているかを学ぶ。 この講義のキーワードは,転写ネットワーク、ゲノム編集技術、ゲノム合成、非天然アミノ酸・核酸、人工細胞、進化工学、バイオテクノロジーです．",
		Url:      "https://google.com",
		Id:       "50409",
	},
	{
		Name:     "生物計算科学",
		Abstract: "マルチオミックス解析から得られる多様かつ膨大な生物情報を解析することで、どのような知識を得ることができるのか。コンピュータを駆使したバイオインフォマティクスの基礎から応用までを理解し、単なるツールとしての技術の習得ではなく、膨大な情報から新たな仮説を導くための論理を習得することを目標とする。より深い理解のため、グループワークなども活用を行う。 この講義のキーワードは,バイオインフォマティクスです．",
		Url:      "https://google.com",
		Id:       "50410",
	},
	{
		Name:     "生命情報学",
		Abstract: "本講義では、生命科学・情報科学・統計力学の融合により誕生したバイオインフォマティクス（生命情報学）の基礎を学習する。 山田：ゲノム、メタゲノム解析の基盤となるバイオインフォマティクスの基礎の理解 （6回）北尾：生命の微視的状態の情報と巨視的状態の情報を結びつける統計力学を学ぶ。（8回） この講義のキーワードは,生命情報学、データベース、配列解析、系統解析物理化学、熱力学、統計力学、生物物理学です．",
		Url:      "https://google.com",
		Id:       "50411",
	},
	{
		Name:     "医用生物工学",
		Abstract: "「医用生物工学」は、生物工学の技術を利用することによって医用に役立てる技術開発を行うための工学体系である。応用する医用分野は、がんをはじめとする生活習慣病など様々な疾病が対象となる。講義では人に応用する材料や技術を開発する上での基礎を学ぶとともに、イメージング・バイオマーカーなどを用いた疾患診断技術や、再生医療・ドラックデリバリーシステム・がん治療などの創薬開発についても学ぶ。 この講義のキーワードは,生物工学材料、体内動態、イメージングプローブ、ドラッグデリバリーシステム、バイオセンサ、感染症、生活習慣病、アレルギー、がん、がんの診断、がんの治療です．",
		Url:      "https://google.com",
		Id:       "50412",
	}, {
		Name:     "分子発生・進化学",
		Abstract: "本講義では、発生・再生生物学、進化生物学の基礎から発展的内容まで広く理解することを目標とする。動物の発生、器官の形成のプロセスとその制御機構を理解し、遺伝子工学や幹細胞などの応用技術との関わりを学ぶ。さらに、形態進化、ゲノム進化、さらに、組織恒常性と再生など基礎生物学について基礎概念や原理、最新の研究を理解する。 この講義のキーワードは,発生、器官形成、進化、内胚葉、遺伝子工学、幹細胞、再生、分子進化、組織恒常性です．",
		Url:      "https://google.com",
		Id:       "50413",
	}, {
		Name:     "バイオ工学基礎",
		Abstract: "バイオテクノロジーを中心とした生命科学は産業の新しい基盤として発展している。微生物をはじめとして生物の多様な機能を工業的に利用する取組みは進んでおり、次世代を担う革新的なプロセス提供が可能となっている。そこで本講義では、バイオプロセスの基礎となる生物工学の基本的な内容の習得を目的とする。 前半の講義では、微生物を中心に細胞の増殖や諸機能について説明する。次に、セントラルドグマ（遺伝子の複製、転写、翻訳）からはじまり、遺伝子工学の基礎（酵素、分子解析手法、クローニング）について解説する。後半の講義では、最先端技術を利用したバイオ計測技術についても触れ、遺伝子発現、タンパク質、代謝の網羅的解析法を活用した有用物質生産についても解説する。 この講義のキーワードは,DNA, タンパク質, mRNA, 遺伝子工学, オミクステクノロジーです．",
		Url:      "https://google.com",
		Id:       "50414",
	},
}

var DemoLecture1 = LectureRes{
	{
		Name:     "問題解決と意思決定",
		Abstract: "本講義では，システムの解析や設計において必要となる最適化のモデルと方法論について学びます．具体的には，線形計画モデル，線形計画法，非線形計画モデル，非線形計画法，多目的最適化手法，整数計画法，組合せ最適化手法など，最適化のためのモデル化と方法論について講義します．本講義を履修することによって，システムの解析や設計において必要となる最適化に関する知識を習得し，実世界の問題に応用できるようになることを到達目標とします． この講義のキーワードは,線形計画，非線形計画，多目的最適化，整数計画，組合せ最適化です．",
		Url:      "https://google.com",
		Id:       "30405",
	},
	{
		Name:     "数理最適化",
		Abstract: "この科目は講義と演習からなる。講義の部分では、数理最適化モデルの基礎となっている線形計画問題について、代表的な解法であるシンプレックス法および双対定理などの理論面を扱う。非線形最適化では、最適解の満たす最適性条件の理論的性質についてふれた後、最急降下法や内点法などの計算手法を扱う。演習の部分では、シンプレックス法を実際に線形計画問題に適用し、その手順を確認する。また、講義内容の証明の一部などを行うことで、理論面の理解を深める。数理最適化は、「特定の条件を満たす中から、最適な解を選び出す」という最適化に数学的なアプローチを行う学問であり、理学・工学の諸問題と密接に関係しているだけでなく、実社会に幅広く用いられている。例えば、必要なエネルギーを確保する食事メニューの中から、最小カロリーとなっているメニューを選び出す、などのようなダイエット問題を数学でどのように解くか、というようなことが考えられる。実社会の最適化問題をどのような数学的性質を使って性質をどのような手順で解いていくのか、理論面と計算面の２つを楽しめる科目である。 この講義のキーワードは,線形計画問題，シンプレックス法，双対理論，感度分析，最短路問題，最大流問題，凸関数，非線形最適化問題の最適性条件，Karush-Kuhn-Tucker 条件，最急降下法，Newton 法，逐次２次計画法，内点法です．",
		Url:      "https://google.com",
		Id:       "30406",
	},
	{
		Name:     "経営・経済のための基礎数理",
		Abstract: "経営･経済学におけるモデル構築において必要な，数理的な手法を学ぶ。特にこの授業では，命題論理, 写像と対応, 同値関係, 最大最小などを扱う。学生が経営・経済における諸問題を扱うための基礎数理を身につける。 この講義のキーワードは,命題論理, 写像と対応, 同値関係, 最大最小です．",
		Url:      "https://google.com",
		Id:       "30407",
	},
	{
		Name:     "計算機支援数理",
		Abstract: "この講義では，数理最適化に対する計算手法を幅広く概説し，工学への適用事例についても述べる。計算手法としては，線形計画問題に対する内点法を述べた後に，制約なし非線形最適化問題に対する各手法を述べ，制約付き最適化問題を扱う。また，組合せ最適化問題の定式化および計算手法についても扱う。工学への適用事例としては，機械計測や自然をお手本とした最適化などを扱う。近年の計算機の急速な進歩により，数理科学の方法論には大きな変革がもたらされており，それと同時に，その進歩を有効に活用するための新たな数理計算技術が要請されている。数理最適化の計算手法は，そのような数理計算技術の１つであり，複数の計算手法がどのように活用できるのかを知ることは複雑な実問題を解決する上で大きなメリットである。また，工学の適用事例についても触れることで，計算機と最適化計算手法の進歩を感じ取ることができるであろう。 この講義のキーワードは,数理最適化，主双対内点法，最適化計算手法，最適性条件，２次錐計画問題，半正定値計画問題，工学における最適化，組合せ最適化，メタヒューリスティクス，分枝限定法，半正定値緩和です．",
		Url:      "https://google.com",
		Id:       "30408",
	},
	{
		Name:     "数理情報分析応用II",
		Abstract: "深層学習（ディープラーニング）や数理最適化手法は産業や社会にとって欠かせない技術のひとつとなりつつある。これらの技術は特定の分野に限定されない汎用的な特性を持つことから今後も幅広い分野において応用事例が増加していくと目される。本講義ではまず強化学習及び深層強化学習を理解する。併せて、数理計画法及びメタヒューリスティクスといった最適解探索手法を理解する。最後に、量子コンピューティングの特徴ならびに技術開発動向を理解する。なお、機械学習ならびに数理計画法の初学者でも無理なく学習できるよう配慮し、各手法の適用事例を踏まえつつ、アルゴリズムの原理及び簡易的な手法の実装力を身につける。 この講義のキーワードは,深層学習、Python、プログラミング、強化学習、数理計画法、量子コンピューティングです．",
		Url:      "https://google.com",
		Id:       "30409",
	},
	{
		Name:     "オペレーションズ・リサーチ 基礎",
		Abstract: "基本的な最適化モデルである線形計画法、非線形計画法、ネットワーク計画法、組合せ最適化を取り上げ、それらのモデルの諸性質や解法を学ぶ。経営活動に関わる複雑な問題を科学的に分析し合理的な意思決定を行うためには、オペレーションズ・リサーチの技術が役立つ。その中でも特によく使われる最適化モデルと解法を学ぶことにより、問題解決力を身に付ける。 この講義のキーワードは,線形計画法、非線形計画法、ネットワーク最適化、組合せ最適化です．",
		Url:      "https://google.com",
		Id:       "30410",
	},
	{
		Name:     "計量経済学第二",
		Abstract: "社会経済データを分析する際に必要となる、計量経済学の基本的手法を習得するための学部生向け講義である。使用言語は日本語であるが、上級計量経済学との接続を考慮し板書に英語を利用する。 この講義のキーワードは,最小二乗法、内生性、操作変数、パネルデータです．",
		Url:      "https://google.com",
		Id:       "30411",
	},
	{
		Name:     "数理工学",
		Abstract: "本講義では、内積空間、固有値、微分方程式の求解法、ラプラス変換、フーリエ解析について学ぶ。講義を聴くだけでなく、自らが問題を解くことで理解が促進されるため、１回の講義に対し１回の演習を行う。経営工学を理解するためには、線形代数や解析学を習得していることは必須である。線形代数や解析学の基本的な理論や手法について一通り身に付けることにより、これから多くの学問を学んでいくための土台をつくる。 この講義のキーワードは,数学, 経営工学, 内積空間, 微分方程式です．",
		Url:      "https://google.com",
		Id:       "30412",
	},
	{
		Name:     "経営・経済数学",
		Abstract: "経営・経済のために必要な基礎数理について学ぶ．ユークリッド空間，距離空間，位相空間，点列の収束，連続関数，凸集合と凸関数などの内容を扱う．学生が経営・経済における諸問題を数理的・工学的に扱うための基礎数理を身に着け，演習を通して応用問題に適用できる力をつける． この講義のキーワードは,ユークリッド空間，距離空間，位相空間，点列の収束，連続関数，凸集合，凸関数です．",
		Url:      "https://google.com",
		Id:       "30413",
	},
}

var DemoReason = map[string]Reason{
	"30405": {
		Id: "30405",
		Reason: `# 推薦理由(問題解決と意思決定)

私は、[問題解決と意思決定]の授業を強くお勧めします。この授業は、[私の目標]である「数理最適化を用いて貧困問題を解決したい」という目標を達成するために必要な知識とスキルを身につけることができます。以下に、授業の内容が目標達成にどのように役立つかを説明します。

1. **線形計画モデルと線形計画法**: この授業では、線形計画モデルと線形計画法について学びます。これらの手法は、貧困問題を解決するための資源配分や政策決定において、効率的な解決策を見つけるために役立ちます。
2. **非線形計画モデルと非線形計画法**: 貧困問題において、すべての変数や制約が線形であるとは限りません。非線形計画モデルと非線形計画法を学ぶことで、より現実的な問題設定に対応する最適化手法を習得できます。
3. **多目的最適化手法**: 貧困問題を解決するためには、経済成長、教育、健康、インフラなど、さまざまな目標を同時に達成する必要があります。多目的最適化手法を学ぶことで、これらの目標をトレードオフしながら最適な解決策を見つけることができます。
4. **整数計画法**: 貧困問題において、整数でなければならない変数（例えば、人数や施設の数）が存在することがあります。整数計画法を学ぶことで、このような制約を持つ問題に対処することができます。
5. **組合せ最適化手法**: 貧困問題を解決するためには、さまざまな選択肢の中から最適な組み合わせを見つける必要があります。組合せ最適化手法を学ぶことで、効率的に最適な選択肢を見つけることができます。

以上の理由から、[科目名問題解決と意思決定]の授業は、[私の目標]である「数理最適化を用いて貧困問題を解決したい」という目標を達成するために必要な知識とスキルを習得するために最適な授業です。この授業を受講することで、実世界の問題に対して最適化手法を応用し、貧困問題の解決に貢献できるようになるでしょう。`,
	},
	"30406": {
		Id: "30406", Reason: `# 推薦理由(数理最適化)

数理最適化の授業は、貧困問題を解決するために非常に重要な役割を果たします。この授業では、線形計画問題や非線形最適化問題などの最適化手法を学ぶことができます。これらの手法は、貧困問題に対する効果的な解決策を見つけるために役立ちます。

まず、線形計画問題とシンプレックス法を学ぶことで、貧困問題に関連するリソースの最適な配分を見つけることができます。例えば、限られた予算の中で、教育や医療、インフラなどの分野にどのように資源を割り振るべきかを決定することができます。また、双対理論や感度分析を用いて、各分野への投資が貧困削減にどの程度の効果をもたらすかを評価することもできます。

次に、最短路問題や最大流問題を学ぶことで、貧困地域への物資やサービスの効率的な配送ルートを見つけることができます。これにより、貧困地域への支援が迅速かつ効果的に行われることが期待できます。

さらに、非線形最適化問題の最適性条件やKarush-Kuhn-Tucker条件を学ぶことで、貧困問題に対するより複雑な解決策を見つけることができます。例えば、経済成長と環境保護のバランスを考慮した持続可能な開発戦略を立案することができます。

最後に、最急降下法やNewton法、逐次二次計画法、内点法などの計算手法を学ぶことで、貧困問題に対する最適解を効率的に求めることができます。これにより、貧困問題の解決策を迅速に実行に移すことができます。

総じて、数理最適化の授業は、貧困問題を解決するために必要な理論的知識と計算手法を提供します。これらの知識と手法を活用することで、貧困問題に対する効果的で持続可能な解決策を見つけることができるでしょう。`,
	},
	"30407": {
		Id: "30407", Reason: `# 推薦理由(経営・経済のための基礎数理)

私は、経営・経済のための基礎数理という授業を強くお勧めします。なぜなら、この授業はあなたの目標である「数理最適化を用いて貧困問題を解決したい」という目標を達成するために必要な基礎知識を身につけることができるからです。具体的には、以下の点があなたの目標達成に役立ちます。

1. **命題論理**: 貧困問題を解決するためには、複雑な現実世界の問題を数理モデルに落とし込む必要があります。命題論理は、現実世界の問題を論理的に整理し、数学的な表現に変換するための基本的なツールです。この授業で命題論理を学ぶことで、貧困問題に関連する様々な要素を論理的に捉え、数理最適化の対象とすることができます。
2. **写像と対応**: 貧困問題を数理モデル化する際には、様々な要素間の関係を明確にする必要があります。写像と対応は、要素間の関係を数学的に表現するための重要な概念です。この授業で写像と対応を学ぶことで、貧困問題に関連する要素間の関係を数学的に捉え、数理最適化の手法を適用することができます。
3. **同値関係**: 貧困問題を解決するためには、異なる視点から問題を捉えることが重要です。同値関係は、異なる要素や条件が同じ性質を持つことを示すための数学的な概念です。この授業で同値関係を学ぶことで、貧困問題に関連する様々な要素や条件を同じ性質を持つグループに分類し、効果的な数理最適化のアプローチを見つけることができます。
4. **最大最小**: 数理最適化の目的は、ある目的関数を最大化または最小化する解を見つけることです。最大最小の概念は、数理最適化の基本的な考え方であり、この授業で最大最小を学ぶことで、貧困問題に対する最適な解決策を見つけるための数学的な手法を身につけることができます。

以上の理由から、経営・経済のための基礎数理という授業は、あなたの目標である「数理最適化を用いて貧困問題を解決したい」という目標を達成するために必要な知識を身につけることができると考えます。この授業を受講することで、貧困問題に対する効果的な数理最適化のアプローチを見つける力を身につけることができるでしょう。`,
	},
	"50405": {
		Id: "50405", Reason: `# 推薦理由(ゲノム情報学)

ゲノム情報学の授業は、あなたの目標である「個別化医療社会を作りたい」という目標を達成するために非常に重要な要素です。以下に、その理由を具体的な授業内容に触れながら説明します。

1. **ゲノム情報学の基礎理解**: この授業では、ゲノム情報学の基礎を学ぶことができます。ゲノム情報学は、生物学と情報科学の両方の知識を必要とする分野であり、個別化医療を実現するためには、この分野の理解が不可欠です。
2. **配列解析の技術**: 個別化医療を実現するためには、患者のゲノム情報を正確に解析し、遺伝子の変異や発現パターンを把握することが重要です。この授業では、配列解析の技術を学ぶことができます。これにより、患者のゲノム情報を解析し、適切な治療法を提案する能力を身につけることができます。
3. **次世代シークエンサーの活用**: この授業では、次世代シークエンサーという最先端の技術についても学ぶことができます。次世代シークエンサーは、ゲノム情報解析の分野で急速な発展を遂げており、個別化医療の実現に欠かせない技術です。この技術を理解し、活用することで、より効率的かつ正確なゲノム情報解析が可能となります。
4. **バイオインフォマティクスの応用**: ゲノム情報学は、バイオインフォマティクスの一分野であり、この授業で学んだ知識を他のバイオインフォマティクス分野にも応用することができます。これにより、個別化医療だけでなく、疾患の診断や治療法の開発、遺伝子編集技術など、幅広い分野で活躍することができます。

以上の理由から、ゲノム情報学の授業は、あなたの目標である「個別化医療社会を作りたい」という目標を達成するために必要な知識と技術を身につけるための重要なステップとなります。この授業を通じて、ゲノム情報解析のエキスパートとなり、個別化医療社会の実現に貢献してください。`,
	},
	"50407": {
		Id: "50407", Reason: `# 推薦理由(バイオインフォマティクス)

与えられた授業である**バイオインフォマティクス**は、あなたの目標である「ゲノム情報の解析によって個別化医療社会を作りたい」という目標を達成するために必要な要素を多く含んでいます。以下にその理由を詳しく説明します。

1. **ゲノム情報解析**: この授業では、ゲノム情報解析の基本的な技術や手法を学ぶことができます。ゲノム情報は個人の遺伝情報を含んでおり、個別化医療の基盤となるデータです。ゲノム情報解析を理解することで、個別の患者に適した治療法や薬物を選択することが可能になります。
2. **タンパク質構造情報解析**: タンパク質は、生物の機能を担う分子であり、その構造や機能の解析は、疾患の原因や治療法の開発に不可欠です。この授業では、タンパク質構造情報解析の最新の研究や手法を学ぶことができます。これにより、個別化医療において重要なタンパク質の機能や相互作用を理解し、効果的な治療法を開発することができます。
3. **化学情報学**: 化学情報学は、化合物や薬物の構造や性質を解析するための手法を提供します。この授業では、化学情報学の基本的な知識や技術を学ぶことができます。これにより、個別化医療において、患者に適した薬物を選択する際に役立つ情報を得ることができます。
4. **計算生物学**: 計算生物学は、生物学的データを解析するための数理的技法を提供します。この授業では、計算生物学の概要と応用例を学ぶことができます。これにより、個別化医療において、大量のデータから意味のある情報を抽出し、患者に適した治療法や薬物を選択するための手法を習得することができます。

以上の理由から、バイオインフォマティクスの授業は、あなたの目標である「ゲノム情報の解析によって個別化医療社会を作りたい」という目標を達成するために必要な知識や技術を身につけることができます。この授業を受講することで、個別化医療の実現に向けた大きな一歩を踏み出すことができるでしょう。`,
	},
}

var DemoBook = map[string]BookRes{
	"30405": {
		{
			ID:     "30405",
			Name:   "しっかり学ぶ数理最適化 : モデルからアルゴリズムまで",
			Author: "梅谷俊治",
		},
		{
			ID:     "30405",
			Name:   "はじめての最適化",
			Author: "関口良行",
		},
		{
			ID:     "30405",
			Name:   "数理最適化の実践ガイド",
			Author: "穴井宏和",
		},
		{
			ID:     "30405",
			Name:   "Juliaによる数理最適化",
			Author: "小林和博",
		},
		{
			ID:     "30405",
			Name:   "あたらしい数理最適化 : Python言語とGurobiで解く",
			Author: "久保幹雄 [ほか]",
		},
	},
	"30406": {
		{
			ID:     "30406",
			Name:   "しっかり学ぶ数理最適化 : モデルからアルゴリズムまで",
			Author: "梅谷俊治",
		},
		{
			ID:     "30406",
			Name:   "はじめての最適化",
			Author: "関口良行",
		},
		{
			ID:     "30406",
			Name:   "数理最適化の実践ガイド",
			Author: "穴井宏和",
		},
		{
			ID:     "30406",
			Name:   "Juliaによる数理最適化",
			Author: "小林和博",
		},
		{
			ID:     "30406",
			Name:   "あたらしい数理最適化 : Python言語とGurobiで解く",
			Author: "久保幹雄 [ほか]",
		},
	},
	"30407": {
		{
			ID:     "30407",
			Name:   "ベーシック経済学 : 次につながる基礎固め",
			Author: "古沢泰治, 塩路悦朗",
		},
		{
			ID:     "30407",
			Name:   "計量経済学",
			Author: "黒住英司",
		},
		{
			ID:     "30407",
			Name:   "経済学と合理性 : 経済学の真の標準化に向けて",
			Author: "清水和巳",
		},
		{
			ID:     "30407",
			Name:   "計量経済学のための統計学 岩澤政宗著 経営情報学 : 理論と現象をつなぐ論理",
			Author: "木嶋恭一, 岸眞理子著",
		},
		{
			ID:     "30407",
			Name:   "レクチャー&エクササイズ経済学入門",
			Author: "上村敏之",
		},
	},
	"50405": {
		{
			ID:     "30407",
			Name:   "Web連携テキストバイオインフォマティクス : 基礎から応用",
			Author: "門田幸二 [ほか]",
		},
		{
			ID:     "30407",
			Name:   "東京大学バイオインフォマティクス集中講義",
			Author: "東京大学理学部生物情報科学学部教育特別プログラム",
		},
		{
			ID:     "30407",
			Name:   "バイオインフォマティクスのための生命科学入門",
			Author: "福永津嵩, 岩切淳一",
		},
		{
			ID:     "30407",
			Name:   "ゲノム医学 : ゲノム情報を活かす医療のために",
			Author: "Tom Strachan, Judith Goodship, Patrick Chinnery",
		},
	},
	"50407": {},
}

func main() {
	http.HandleFunc("/chat", chatHandler)
	http.HandleFunc("/lecture", lectureHandler)
	http.HandleFunc("/book", bookHandler)
	http.ListenAndServe(":8080", nil)
}

func chatHandler(w http.ResponseWriter, r *http.Request) {
	time.Sleep(1 * time.Second)
	switch r.Method {
	case http.MethodPost:
		{
			var reqData ChatReq
			if err := json.NewDecoder(r.Body).Decode(&reqData); err != nil {
				http.Error(w, "Invalid request body", http.StatusBadRequest)
				return
			}

			flusher, ok := w.(http.Flusher)
			if !ok {
				http.Error(w, "SSE not supported", http.StatusInternalServerError)
				return
			}
			w.Header().Set("Content-Type", "application/json")
			w.Header().Set("Access-Control-Allow-Origin", "*")
			w.Header().Set("Access-Control-Allow-Methods", "GET, POST, OPTIONS")
			w.Header().Set("Access-Control-Allow-Headers", "Content-Type")

			id := reqData.ID
			chunkCh := make(chan string)
			go chunkGenerator(r.Context(), chunkCh, DemoReason[id].Reason)

			var data ChatRes
			for chunk := range chunkCh {
				data.Message = chunk
				data.Lecture = "サンプル講義"
				event, err := sseFormatter(data)
				if err != nil {
					fmt.Println(err)
					break
				}

				_, err = fmt.Fprint(w, event)
				if err != nil {
					fmt.Println(err)
					break
				}

				flusher.Flush()
			}
		}
	case http.MethodOptions:
		w.Header().Set("Access-Control-Allow-Origin", "*")
		w.Header().Set("Access-Control-Allow-Methods", "GET, POST, OPTIONS")
		w.Header().Set("Access-Control-Allow-Headers", "Content-Type")
		w.WriteHeader(http.StatusOK)
	}
}

func chunkGenerator(c context.Context, chunkCh chan string, demoM string) {
	ticker := time.NewTicker(time.Millisecond * 40)

	msg := []rune(demoM)
	msgLength := len(msg)

loop:
	for i := 0; i < msgLength; i++ {
		select {
		case <-c.Done():
			break loop
		case <-ticker.C:
			chunkCh <- string(msg[i]) // UTF-8 エンコードされた文字列を送信
		}
	}

	ticker.Stop()
	close(chunkCh)
}

func sseFormatter(data any) (string, error) {
	m, err := json.Marshal(data)
	if err != nil {
		return "", err
	}
	buf := bytes.NewBuffer([]byte{})

	_, err = buf.Write(m)

	if err != nil {
		return "", err
	}

	sseData := fmt.Sprintf("data: %v\n\n", buf.String())
	return sseData, nil
}

func lectureHandler(w http.ResponseWriter, r *http.Request) {
	switch r.Method {
	case http.MethodPost:
		w.Header().Set("Content-Type", "application/json")
		w.Header().Set("Access-Control-Allow-Origin", "*")
		w.Header().Set("Access-Control-Allow-Methods", "GET, POST, OPTIONS")
		w.Header().Set("Access-Control-Allow-Headers", "Content-Type")
		var reqData BookReq
		if err := json.NewDecoder(r.Body).Decode(&reqData); err != nil {
			http.Error(w, "Invalid request body", http.StatusBadRequest)
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.Header().Set("Access-Control-Allow-Origin", "*")
		time.Sleep(9 * time.Second)
		var DemoLecture LectureRes
		if reqData.ID == "3" {
			DemoLecture = DemoLecture1
		} else {
			DemoLecture = DemoLecture2
		}
		if err := json.NewEncoder(w).Encode(DemoLecture); err != nil {
			http.Error(w, "Failed to encode JSON", http.StatusInternalServerError)
			return
		}
	case http.MethodOptions:
		w.Header().Set("Access-Control-Allow-Origin", "*")
		w.Header().Set("Access-Control-Allow-Methods", "GET, POST, OPTIONS")
		w.Header().Set("Access-Control-Allow-Headers", "Content-Type")
		w.WriteHeader(http.StatusOK)

	}

}

func bookHandler(w http.ResponseWriter, r *http.Request) {
	switch r.Method {
	case http.MethodPost:
		var reqData BookReq
		if err := json.NewDecoder(r.Body).Decode(&reqData); err != nil {
			http.Error(w, "Invalid request body", http.StatusBadRequest)
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.Header().Set("Access-Control-Allow-Origin", "*")
		time.Sleep(4 * time.Second)

		if err := json.NewEncoder(w).Encode(DemoBook[reqData.ID]); err != nil {
			http.Error(w, "Failed to encode JSON", http.StatusInternalServerError)
			return
		}
	}
}
